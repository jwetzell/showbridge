<ng-container *ngIf="trigger && schema">
  <div
    class="flex w-fit"
    [style.opacity]="this.trigger.enabled ? '1.0' : '0.5'"
    [style.align-items]="
      this.trigger.actions === undefined || this.trigger.actions.length === 0 ? 'center' : 'baseline'
    ">
    <div
      class="flex flex-col my-3 ml-5 bg-gray-800 border-2 {{
        isInError() ? 'border-red-500' : 'border-gray-200'
      }} border-solid trigger w-fit"
      [cdkContextMenuTriggerFor]="triggerContextMenu">
      <div class="flex items-center justify-center m-1">
        <div
          class="flex-auto mx-2 text-gray-200 whitespace-nowrap w-fit"
          [matTooltip]="trigger.comment ? trigger.comment : ''">
          {{ schema.title }}
        </div>
      </div>
      <ng-container *ngIf="trigger.subTriggers as subTriggers">
        <ng-container *ngIf="subTriggers.length > 0">
          <div *ngFor="let subTrigger of subTriggers; let i = index" class="mr-2">
            <app-trigger
              [trigger]="subTrigger"
              [path]="this.path + '/subTriggers/' + i"
              [showActions]="true"
              (delete)="deleteSubTrigger(i)"
              (updated)="subTriggerUpdated()"></app-trigger>
          </div>
        </ng-container>
      </ng-container>
    </div>

    <!-- NOTE(jwetzell): Settings Dialog -->
    <ng-template #settingsDialogRef>
      <form [formGroup]="formGroup" class="h-full">
        <div class="m-2">
          <app-params-form
            [parentSchema]="schema"
            [data]="trigger.params"
            (updated)="paramsUpdated($event)"></app-params-form>
          <div class="flex items-center justify-center">
            <div class="flex-auto">
              <mat-form-field subscriptSizing="dynamic" class="w-full">
                <mat-label>comment: </mat-label>
                <textarea matInput type="text" formControlName="comment"></textarea>
              </mat-form-field>
            </div>
          </div>
        </div>
      </form>
    </ng-template>

    <!-- NOTE(jwetzell): Context Menus -->
    <ng-container *ngIf="showActions">
      <div class="flex flex-col items-center justify-center">
        <mat-icon [style.color]="indicatorColor" class="scale-150">arrow_right</mat-icon>
      </div>
      <div *ngIf="trigger.actions" class="mb-2">
        <div
          [id]="getListId()"
          cdkDropList
          (cdkDropListDropped)="drop($event)"
          [cdkDropListConnectedTo]="listsService.triggerListIds"
          [cdkDropListData]="trigger.actions"
          class="flex flex-col">
          <div *ngIf="trigger.actions.length === 0" class="w-6 h-6"></div>
          <div cdkDrag *ngFor="let action of trigger.actions; let i = index">
            <app-action
              [path]="path + '/actions/' + i"
              [action]="action"
              (delete)="deleteAction(i)"
              (updated)="actionUpdated()"></app-action>
          </div>
        </div>
        <div class="w-full" *ngIf="schemaService.actionTypes.length > 0">
          <div
            *ngIf="copyService.getClipboardForType('Action') | async as copyObject"
            (click)="pasteAction(copyObject)"
            matTooltip="Paste Action"
            class="flex items-center justify-center bg-green-700 hover:cursor-pointer hover:bg-gray-green">
            <mat-icon>content_paste</mat-icon>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <ng-template #triggerContextMenu>
    <div cdkMenu class="flex flex-col bg-gray-600 border border-black border-solid">
      <div (click)="openSettingsDialog()" class="px-2 border border-gray-700 hover:bg-gray-500 hover:cursor-pointer">
        Settings
      </div>
      <div (click)="deleteMe()" class="px-2 border border-gray-700 hover:bg-red-500 hover:cursor-pointer">Delete</div>
      <div (click)="copyMe()" class="px-2 border border-gray-700 hover:bg-green-500 hover:cursor-pointer">Copy</div>
      <div
        cdkMenuItem
        class="px-2 border border-gray-700 hover:bg-green-500 hover:cursor-pointer"
        (click)="toggleEnabled()">
        {{ trigger.enabled ? 'Disable' : 'Enable' }}
      </div>
      <div
        cdkMenuItem
        class="px-2 border border-gray-700 hover:bg-gray-500 hover:cursor-pointer"
        [cdkMenuTriggerFor]="addActionMenu">
        Add Action
      </div>
      <div
        cdkMenuItem
        class="px-2 border border-gray-700 hover:bg-gray-500 hover:cursor-pointer"
        [cdkMenuTriggerFor]="addTriggerMenu">
        Add Subtrigger
      </div>
    </div>
  </ng-template>

  <ng-template #addActionMenu>
    <div
      cdkMenu
      class="flex flex-col bg-gray-600 border border-black border-solid"
      *ngIf="schemaService.actionTypes.length > 0">
      <div
        cdkMenuItem
        class="px-2 border border-gray-700 hover:bg-gray-500 hover:cursor-pointer"
        *ngFor="let actionType of schemaService.actionTypes"
        (click)="addAction(actionType.type)">
        <span>{{ actionType.name }}</span>
      </div>
    </div>
  </ng-template>

  <ng-template #addTriggerMenu>
    <div
      cdkMenu
      class="flex flex-col bg-gray-600 border border-black border-solid"
      *ngIf="schemaService.triggerTypes.length > 0">
      <div
        cdkMenuItem
        class="px-2 border border-gray-700 hover:bg-gray-500 hover:cursor-pointer"
        *ngFor="let triggerType of schemaService.triggerTypes"
        (click)="addSubTrigger(triggerType.type)">
        <span>{{ triggerType.name }}</span>
      </div>
    </div>
  </ng-template>
</ng-container>
